(function(f,b,g){var d=b.event,a;d.special.smartresize={setup:function(){b(this).bind("resize",d.special.smartresize.handler)},teardown:function(){b(this).unbind("resize",d.special.smartresize.handler)},handler:function(j,h){var k=this,i=arguments;j.type="smartresize",a&&clearTimeout(a),a=setTimeout(function(){d.dispatch.apply(k,i)},h==="execAsap"?0:100)}},b.fn.smartresize=function(h){return h?this.bind("smartresize",h):this.trigger("smartresize",["execAsap"])},b.Mason=function(h,i){this.element=b(i),this._create(h),this._init()},b.Mason.settings={isResizable:!0,isAnimated:!1,animationOptions:{queue:!1,duration:500},gutterWidth:0,isRTL:!1,isFitWidth:!1,containerStyle:{position:"relative"}},b.Mason.prototype={_filterFindBricks:function(i){var h=this.options.itemSelector;return h?i.filter(h).add(i.find(h)):i},_getBricks:function(i){var h=this._filterFindBricks(i).css({position:"absolute"}).addClass("masonry-brick");return h},_create:function(p){this.options=b.extend(!0,{},b.Mason.settings,p),this.styleQueue=[];var l=this.element[0].style;this.originalStyle={height:l.height||""};var j=this.options.containerStyle;for(var k in j){this.originalStyle[k]=l[k]||""}this.element.css(j),this.horizontalDirection=this.options.isRTL?"right":"left";var m=this.element.css("padding-"+this.horizontalDirection),h=this.element.css("padding-top");this.offset={x:m?parseInt(m,10):0,y:h?parseInt(h,10):0},this.isFluid=this.options.columnWidth&&typeof this.options.columnWidth=="function";var e=this;setTimeout(function(){e.element.addClass("masonry")},0),this.options.isResizable&&b(f).bind("smartresize.masonry",function(){e.resize()}),this.reloadItems()},_init:function(h){this._getColumns(),this._reLayout(h)},option:function(h,i){b.isPlainObject(h)&&(this.options=b.extend(!0,this.options,h))},layout:function(m,v){for(var k=0,h=m.length;k<h;k++){this._placeBrick(m[k])}var l={};l.height=Math.max.apply(Math,this.colYs);if(this.options.isFitWidth){var w=0;k=this.cols;while(--k){if(this.colYs[k]!==0){break}w++}l.width=(this.cols-w)*this.columnWidth-this.options.gutterWidth}this.styleQueue.push({$el:this.element,style:l});var j=this.isLaidOut?this.options.isAnimated?"animate":"css":"css",q=this.options.animationOptions,p;for(k=0,h=this.styleQueue.length;k<h;k++){p=this.styleQueue[k],p.$el[j](p.style,q)}this.styleQueue=[],v&&v.call(m),this.isLaidOut=!0},_getColumns:function(){var i=this.options.isFitWidth?this.element.parent():this.element,h=i.width();this.columnWidth=this.isFluid?this.options.columnWidth(h):this.options.columnWidth||this.$bricks.outerWidth(!0)||h,this.columnWidth+=this.options.gutterWidth,this.cols=Math.floor((h+this.options.gutterWidth)/this.columnWidth),this.cols=Math.max(this.cols,1)},_placeBrick:function(y){var q=b(y),j,v,D,m,C;j=Math.ceil(q.outerWidth(!0)/this.columnWidth),j=Math.min(j,this.cols);if(j===1){D=this.colYs}else{v=this.cols+1-j,D=[];for(C=0;C<v;C++){m=this.colYs.slice(C,C+j),D[C]=Math.max.apply(Math,m)}}var B=Math.min.apply(Math,D),x=0;for(var t=0,A=D.length;t<A;t++){if(D[t]===B){x=t;break}}var w={top:B+this.offset.y};w[this.horizontalDirection]=this.columnWidth*x+this.offset.x,this.styleQueue.push({$el:q,style:w});var k=B+q.outerHeight(!0),z=this.cols+1-A;for(t=0;t<z;t++){this.colYs[x+t]=k}},resize:function(){var h=this.cols;this._getColumns(),(this.isFluid||this.cols!==h)&&this._reLayout()},_reLayout:function(i){var h=this.cols;this.colYs=[];while(h--){this.colYs.push(0)}this.layout(this.$bricks,i)},reloadItems:function(){this.$bricks=this._getBricks(this.element.children())},reload:function(h){this.reloadItems(),this._init(h)},appended:function(j,h,k){if(h){this._filterFindBricks(j).css({top:this.element.height()});var i=this;setTimeout(function(){i._appended(j,k)},1)}else{this._appended(j,k)}},_appended:function(i,h){var j=this._getBricks(i);this.$bricks=this.$bricks.add(j),this.layout(j,h)},remove:function(h){this.$bricks=this.$bricks.not(h),h.remove()},destroy:function(){this.$bricks.removeClass("masonry-brick").each(function(){this.style.position="",this.style.top="",this.style.left=""});var h=this.element[0].style;for(var e in this.originalStyle){h[e]=this.originalStyle[e]}this.element.unbind(".masonry").removeClass("masonry").removeData("masonry"),b(f).unbind(".masonry")}},b.fn.imagesLoaded=function(p){function j(){p.call(t,m)}function h(i){var o=i.target;o.src!==l&&b.inArray(o,q)===-1&&(q.push(o),--k<=0&&(setTimeout(j),m.unbind(".imagesLoaded",h)))}var t=this,m=t.find("img").add(t.filter("img")),k=m.length,l="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",q=[];return k||j(),m.bind("load.imagesLoaded error.imagesLoaded",h).each(function(){var i=this.src;this.src=l,this.src=i}),t};var c=function(e){f.console&&f.console.error(e)};b.fn.masonry=function(h){if(typeof h=="string"){var i=Array.prototype.slice.call(arguments,1);this.each(function(){var e=b.data(this,"masonry");if(!e){c("cannot call methods on masonry prior to initialization; attempted to call method '"+h+"'");return}if(!b.isFunction(e[h])||h.charAt(0)==="_"){c("no such method '"+h+"' for masonry instance");return}e[h].apply(e,i)})}else{this.each(function(){var e=b.data(this,"masonry");e?(e.option(h||{}),e._init()):b.data(this,"masonry",new b.Mason(h,this))})}return this}})(window,jQuery);